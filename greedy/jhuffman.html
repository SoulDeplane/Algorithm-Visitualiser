<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Huffman Coding Visualizer</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
  #nodesContainer { display: flex; justify-content: center; flex-wrap: wrap; gap: 12px; margin-top: 20px; }
  .node {
    width:70px; height:70px;
    background:steelblue; color:white;
    border-radius:50%; display:flex;
    flex-direction:column; justify-content:center;
    font-weight:bold; font-size:14px;
    transition:background-color 0.3s ease;
  }
  .sorting { background: gold !important; }
  .merging { background: orange !important; }
  .merged  { background: green  !important; }
  #treeArea { margin-top:30px; text-align:left; max-width:700px; margin:0 auto; }
  #codes   { margin-top:40px; font-size:18px; font-weight:bold; }
  button   { margin:15px; padding:10px 18px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<button onclick="startVisual()">Start Visualization</button>
<button onclick="reset()">Reset</button>

<div id="nodesContainer"></div>
<div id="treeArea"></div>
<div id="codes"></div>

<script>
  const nodesData = [
    {char:'A',freq:5},
    {char:'B',freq:9},
    {char:'C',freq:12},
    {char:'D',freq:13},
    {char:'E',freq:16},
    {char:'F',freq:45}
  ];

  const nodesContainer = document.getElementById('nodesContainer');
  const treeArea       = document.getElementById('treeArea');
  const codesArea      = document.getElementById('codes');
  let forest = [];

  function createTreeNode(char,f,left=null,right=null){
    return {char,freq:f,left,right};
  }

  function drawNodes(){
    nodesContainer.innerHTML = '';
    forest.forEach((n,i)=>{
      const d=document.createElement('div');
      d.className='node'; d.id='node-'+i;
      d.innerHTML=`<div>${n.char||''}</div><div>${n.freq}</div>`;
      nodesContainer.appendChild(d);
    });
  }

  function delay(ms){ return new Promise(r=>setTimeout(r,ms)); }

  async function bubbleSortForest(){
    let n = forest.length;
    for(let i=0;i<n-1;i++){
      for(let j=0;j<n-1-i;j++){
        const dj  = document.getElementById('node-'+j),
              dj1 = document.getElementById('node-'+(j+1));
        dj.classList.add('sorting');
        dj1.classList.add('sorting');
        await delay(400);
        if(forest[j].freq > forest[j+1].freq){
          [forest[j],forest[j+1]]=[forest[j+1],forest[j]];
          drawNodes();
          await delay(400);
        }
        dj.classList.remove('sorting');
        dj1.classList.remove('sorting');
      }
    }
  }

  async function buildHuffmanTree(){
    while(forest.length>1){
      // 1) Sort
      await bubbleSortForest();

      // 2) Merge highlight
      const n1=document.getElementById('node-0'),
            n2=document.getElementById('node-1');
      n1.classList.add('merging');
      n2.classList.add('merging');
      await delay(1000);

      // 3) Merge nodes
      const left=forest.shift(), right=forest.shift();
      const merged=createTreeNode(null,left.freq+right.freq,left,right);
      forest.unshift(merged);
      drawNodes();

      // 4) Merged flash
      const m=document.getElementById('node-0');
      m.classList.add('merged');
      await delay(1000);
      m.classList.remove('merged');
      n1.classList.remove('merging');
      n2.classList.remove('merging');
    }
  }

  function getCodes(n,path='',out={}) {
    if(!n) return;
    if(n.char) out[n.char]=path||'0';
    getCodes(n.left, path+'0', out);
    getCodes(n.right,path+'1', out);
    return out;
  }

  function displayCodes(codes){
    codesArea.innerHTML='<h3>Huffman Codes:</h3>';
    for(let c in codes){
      const d=document.createElement('div');
      d.textContent=`${c} : ${codes[c]}`;
      codesArea.appendChild(d);
    }
  }

  async function startVisual(){
    treeArea.innerHTML=''; codesArea.innerHTML='';
    await buildHuffmanTree();
    const codes = getCodes(forest[0]);
    displayCodes(codes);
  }

  function reset(){
    forest = nodesData.map(n=>createTreeNode(n.char,n.freq));
    drawNodes();
    treeArea.innerHTML=''; codesArea.innerHTML='';
  }

  // initialize
  reset();
</script>

</body>
</html>
